<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>é«˜æ‹ä»ªå½±åƒå½’æ¡£ç³»ç»Ÿ - å¢å¼ºé¢„è§ˆç‰ˆ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
         @keyframes hintArrow {
            0%, 100% { transform: translateX(0); }
            50% { transform: translateX(-8px); }
        }
        .guide-hint {
            position: relative; background: #fff1f2; border: 1px solid #fda4af;
            color: #e11d48; padding: 6px 12px; border-radius: 6px;
            font-size: 14px; display: flex; align-items: center;
            animation: hintArrow 2s infinite ease-in-out;
        }
        .guide-hint::before {
            content: ''; position: absolute; left: -12px; top: 50%;
            transform: translateY(-50%); border: 6px solid transparent; border-right-color: #fda4af;
        }
        .modal-mask {
            display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.6);
            z-index: 50; align-items: center; justify-content: center; backdrop-filter: blur(4px);
        }
        #viewerModal {
            display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.9);
            z-index: 100; align-items: center; justify-content: center; cursor: zoom-out;
        }
        .type-item.drag-over { background-color: #dbeafe; border-color: #3b82f6; }
        .photo-thumb { cursor: grab; transition: transform 0.2s; }
        
        .display-box {
            border: 2px dashed #e2e8f0; min-height: 220px;
            display: flex; flex-direction: column; align-items: center;
            justify-content: flex-start; background: #fff;
            transition: all 0.3s; padding: 12px; border-radius: 12px;
            position: relative;
        }
        .display-box.has-data { border: 2px solid #3b82f6; background: #f8fafc; }
        
        .result-tag {
            padding: 2px 6px; border-radius: 4px; font-size: 11px;
            font-weight: bold; display: inline-block; margin-bottom: 4px;
        }
        .tag-ocr-pass { background-color: #dcfce7; color: #15803d; border: 1px solid #bbf7d0; }
        .tag-ocr-nopass { background-color: #fae1dc; color: #f23535; border: 1px solid #f47564; }
        .tag-sim-pass { background-color: #fef9c3; color: #a16207; border: 1px solid #fef08a; }
        
        .ocr-details {
            font-size: 11px; color: #475569; line-height: 1.4;
            background: #fff; padding: 6px; border-radius: 4px;
            border: 1px solid #e2e8f0; width: 100%;
        }

        /* æ–°å¢ï¼šä¸»ç•Œé¢åˆ é™¤æŒ‰é’®æ ·å¼ */
        .delete-btn {
            position: absolute; top: -8px; right: -8px;
            background: #ef4444; color: white; width: 22px; height: 22px;
            border-radius: 50%; display: flex; align-items: center; justify-content: center;
            cursor: pointer; font-size: 14px; opacity: 0; transition: opacity 0.2s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2); z-index: 10;
        }
        .display-box:hover .delete-btn { opacity: 1; }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">

    <div class="p-6">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-10 bg-white p-6 rounded-xl shadow-sm border border-gray-200">
            <div class="flex items-center space-x-6">
                <button onclick="openModal('ä¸´æŸœ')" class="shrink-0 flex items-center bg-blue-600 hover:bg-blue-700 text-white px-8 py-3 rounded-lg shadow-lg shadow-blue-200 transition-all active:scale-95">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"></path></svg>
                    ä¸´æŸœæ‹ç…§
                </button>
                <div class="guide-hint"><span class="font-bold mr-1">â˜š</span> è¯·ç‚¹å‡»æ‹æ‘„ä¸´æŸœææ–™</div>
            </div>

            <div class="flex items-center space-x-6">
                <button onclick="openModal('äº‘æŸœ')" class="shrink-0 flex items-center bg-emerald-600 hover:bg-emerald-700 text-white px-8 py-3 rounded-lg shadow-lg shadow-emerald-200 transition-all active:scale-95">
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path></svg>
                    äº‘æŸœæ‹ç…§
                </button>
                <div class="guide-hint"><span class="font-bold mr-1">â˜š</span> è¯·ç‚¹å‡»æ‹æ‘„äº‘æŸœææ–™</div>
            </div>
        </div>
    </div>

    <div class="p-8">
        <h3 class="text-lg font-bold text-gray-700 mb-6 flex items-center">
            <span class="w-1.5 h-6 bg-blue-600 mr-3 rounded-full"></span>
            å½“å‰é‡‡é›†ç»“æœå±•ç¤ºï¼š<span id="currentBizText" class="ml-2 text-blue-600">å¾…é€‰æ‹©ä¸šåŠ¡</span>
        </h3>
        <div id="mainGrid" class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-5 gap-6"></div>
    </div>

    <div id="cameraModal" class="modal-mask">
        <div class="bg-white w-11/12 h-[90vh] rounded-2xl shadow-2xl flex flex-col overflow-hidden">
            <div class="bg-gray-900 p-4 flex justify-between items-center text-white">
                <div class="flex space-x-3">
                    <button onclick="takePhoto()" class="bg-blue-500 hover:bg-blue-400 px-6 py-2 rounded-lg font-bold transition-colors">ğŸ“· å¼€å§‹æ‹ç…§</button>
                    <button onclick="submitArchive()" class="bg-emerald-500 hover:bg-emerald-400 px-6 py-2 rounded-lg font-bold transition-colors">âœ… ç¡®è®¤æäº¤</button>
                </div>
                <div class="text-lg font-medium" id="modalTitle">å½±åƒé‡‡é›†ç»ˆç«¯</div>
                <button onclick="closeModal()" class="text-gray-400 hover:text-white text-3xl">&times;</button>
            </div>
            
            <div class="flex-1 flex overflow-hidden">
                <div class="w-72 bg-gray-50 border-r p-4 overflow-y-auto" id="modalTypeList"></div>
                
                <div class="flex-1 bg-black flex items-center justify-center relative">
                    <div class="text-gray-600 text-center">
                        <div class="w-16 h-16 border-4 border-gray-800 border-t-blue-500 rounded-full animate-spin mx-auto mb-4"></div>
                        é«˜æ‹ä»ªè§†é¢‘æµåŠ è½½ä¸­...
                    </div>
                </div>

                <div class="w-80 bg-gray-100 border-l p-4 overflow-y-auto">
                    <h4 class="text-xs font-black text-gray-400 mb-4 uppercase tracking-widest">å¾…å½’æ¡£ç…§ç‰‡ (æ‹–æ‹½è‡³å·¦ä¾§åˆ†ç±»)</h4>
                    <div id="photoPool" class="space-y-4"></div>
                </div>
            </div>
        </div>
    </div>

    <div id="viewerModal" onclick="this.style.display='none'">
        <img id="viewerImg" src="" class="max-w-[90%] max-h-[90%] shadow-2xl rounded border-4 border-white">
        <div class="absolute top-5 right-5 text-white text-sm bg-black/50 px-4 py-2 rounded-full">ç‚¹å‡»ä»»æ„ä½ç½®é€€å‡ºé¢„è§ˆ</div>
    </div>

    <script>
        const types = [
            "æŠ•ä¿äººèº«ä»½è¯æ­£é¢", "æŠ•ä¿äººèº«ä»½è¯åé¢", "æŠ•ä¿äººäººåƒæ­£é¢ç…§", 
            "è¢«ä¿äººèº«ä»½è¯æ­£é¢", "è¢«ä¿äººèº«ä»½è¯åé¢", "è¢«ä¿äººäººåƒæ­£é¢ç…§", "å…¶ä»–"
        ];
        
        let tempStorage = {};
        types.forEach(t => tempStorage[t] = []);

        // åˆå§‹åŒ–ä¸»ç•Œé¢ç½‘æ ¼
        function initMainGrid() {
            renderMainGrid();
        }

        // é‡æ–°æ¸²æŸ“ä¸»ç•Œé¢ç½‘æ ¼ï¼ˆæ”¯æŒåˆ é™¤ååˆ·æ–°ï¼‰
        function renderMainGrid() {
            const grid = document.getElementById('mainGrid');
            grid.innerHTML = '';

            for (let type in tempStorage) {
                const files = tempStorage[type];
                
                if (files.length === 0) {
                    grid.insertAdjacentHTML('beforeend', createBoxHtml(type, 0, null));
                } else {
                    files.forEach((file, index) => {
                        grid.insertAdjacentHTML('beforeend', createBoxHtml(type, index, file));
                    });
                }
            }
        }

        function createBoxHtml(name, index, file) {
            const id = index === 0 ? name : `${name}_${index}`;
            const isHasData = file !== null;
            
            // æ¨¡æ‹Ÿè¯†åˆ«ä¿¡æ¯
            let resultHtml = '';
            if (isHasData) {
                if (name.includes("èº«ä»½è¯æ­£é¢")) {
                        const nameMap = {"æŠ•ä¿äºº": "å¼ å»ºå›½", "è¢«ä¿äºº": "å¼ å°æ˜", "æ–°æŠ•ä¿äºº": "æç¾å"};
                        const prefix = name.split('èº«ä»½è¯')[0];
                        const mockName = nameMap[prefix] || "ç‹äº”";
                        
                        resultHtml = `
                            <div class="tag-ocr-pass result-tag">OCRè¯†åˆ«ï¼šé€šè¿‡</div>
                            <div class="ocr-details">
                                <b>å§“åï¼š</b>${mockName}<br>
                                <b>å·ç ï¼š</b>3201198765571524
                            </div>`;
                    } else if (name.includes("èº«ä»½è¯åé¢")) {
                        resultHtml = `
                            <div class="tag-ocr-nopass result-tag">OCRè¯†åˆ«ï¼šä¸é€šè¿‡</div>
                            <div class="ocr-details">
                                <b>ç­¾å‘ï¼š</b>å—äº¬å¸‚å…¬å®‰å±€<br>
                                <b>æœ‰æ•ˆæœŸï¼š</b>2020-2040
                            </div>`;
                    } else if (name.includes("äººåƒæ­£é¢ç…§")) {
                        resultHtml = `<div class="tag-sim-pass result-tag">äººè„¸ç›¸ä¼¼åº¦ï¼š95%</div>`;
                    } else {
                    resultHtml = `<div class="tag-ocr-pass result-tag">å·²å½’æ¡£</div>`;
                }
            }

            return `
                <div id="main-box-${id}" class="display-box shadow-sm ${isHasData ? 'has-data' : ''}">
                    ${isHasData ? `<div class="delete-btn" title="åˆ é™¤" onclick="deleteMainPhoto('${name}', ${index})">Ã—</div>` : ''}
                    <span class="text-xs font-bold text-gray-400 mb-3">${name}${index > 0 ? ' ('+(index+1)+')' : ''}</span>
                    
                    <div class="icon-placeholder text-gray-200 mt-4 ${isHasData ? 'hidden' : ''}">
                        <svg class="w-12 h-12" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"></path></svg>
                    </div>

                    ${isHasData ? `
                        <div class="preview-container w-full flex justify-center mb-3">
                            <img src="${file.src}" class="w-full h-24 object-cover rounded-lg border shadow-sm cursor-zoom-in hover:opacity-80" onclick="previewImage('${file.src}')">
                        </div>
                        <div class="w-full">${resultHtml}</div>
                    ` : ''}
                </div>`;
        }

        // ä¸»ç•Œé¢åˆ é™¤ç…§ç‰‡é€»è¾‘
        function deleteMainPhoto(typeName, index) {
            if(confirm(`ç¡®å®šè¦åˆ é™¤è¿™å¼  ${typeName} å—ï¼Ÿ`)) {
                tempStorage[typeName].splice(index, 1);
                renderMainGrid();
            }
        }

        // --- å¼¹çª—ç›¸å…³é€»è¾‘ ---
        function openModal(biz) {
            document.getElementById('currentBizText').innerText = biz + 'ä¸šåŠ¡';
            document.getElementById('cameraModal').style.display = 'flex';
            renderTypeList();
        }

        function renderTypeList() {
            const list = document.getElementById('modalTypeList');
            list.innerHTML = '<h4 class="text-xs font-black text-gray-400 mb-4 uppercase">å½±åƒåˆ†ç±»</h4>';
            
            types.forEach(typeName => {
                const files = tempStorage[typeName];
                const typeItem = document.createElement('div');
                typeItem.className = `type-item border p-3 rounded-xl mb-3 transition-all ${files.length > 0 ? 'bg-blue-50 border-blue-200' : 'bg-white border-gray-100'}`;
                
                typeItem.ondragover = (e) => { e.preventDefault(); typeItem.classList.add('drag-over'); };
                typeItem.ondragleave = () => typeItem.classList.remove('drag-over');
                typeItem.ondrop = (e) => { typeItem.classList.remove('drag-over'); handleDrop(e, typeName); };

                let filesHtml = files.map((file, idx) => `
                    <div class="group relative flex items-center p-1.5 bg-white rounded-lg mt-2 border border-gray-200 hover:shadow-md transition-all">
                        <img src="${file.src}" class="w-10 h-10 object-cover rounded cursor-zoom-in" onclick="previewImage('${file.src}')">
                        <span class="text-[10px] text-gray-500 truncate flex-1 ml-2">${file.name}</span>
                        <button onclick="removeFile('${typeName}', ${idx})" class="opacity-0 group-hover:opacity-100 absolute -right-2 -top-2 bg-red-500 text-white rounded-full w-5 h-5 flex items-center justify-center text-xs shadow-lg">Ã—</button>
                    </div>
                `).join('');

                typeItem.innerHTML = `
                    <div class="flex justify-between items-center">
                        <span class="text-sm font-bold text-gray-700">${typeName}</span>
                        <span class="bg-blue-600 text-white px-2 py-0.5 rounded-full text-[10px] ${files.length ? '' : 'hidden'}">${files.length}</span>
                    </div>
                    <div class="space-y-1">${filesHtml || '<div class="text-[10px] text-gray-300 italic mt-1">è¯·æ‹–å…¥ç…§ç‰‡</div>'}</div>
                `;
                list.appendChild(typeItem);
            });
        }

        function takePhoto() {
            const id = 'p_' + Date.now();
            const fileName = `IMG_${id.slice(-4)}.jpg`;
            const color = Math.floor(Math.random()*16777215).toString(16);
            const dummySrc = `https://via.placeholder.com/600x400/${color}/ffffff?text=${fileName}`;
            
            const card = document.createElement('div');
            card.className = "photo-thumb bg-white p-2 rounded-lg shadow-sm border border-gray-200 group relative";
            card.draggable = true;
            card.id = id;
            card.dataset.filename = fileName;
            card.dataset.src = dummySrc;
            card.ondragstart = (e) => e.dataTransfer.setData("text", id);
            card.innerHTML = `
                <img src="${dummySrc}" class="w-full h-32 object-cover rounded mb-2">
                <div class="flex justify-between items-center">
                    <span class="text-[10px] font-mono text-gray-400">${fileName}</span>
                    <button onclick="previewImage('${dummySrc}')" class="text-blue-500 text-[10px] hover:underline">ç‚¹å‡»æ”¾å¤§</button>
                </div>`;
            document.getElementById('photoPool').prepend(card);
        }

        function handleDrop(e, targetType) {
            e.preventDefault();
            const photoId = e.dataTransfer.getData("text");
            if (!photoId) return;
            const el = document.getElementById(photoId);
            if (el) {
                tempStorage[targetType].push({ src: el.dataset.src, name: el.dataset.filename });
                el.remove();
                renderTypeList();
            }
        }

        function removeFile(typeName, index) {
            tempStorage[typeName].splice(index, 1);
            renderTypeList();
        }

        function previewImage(src) {
            const modal = document.getElementById('viewerModal');
            document.getElementById('viewerImg').src = src;
            modal.style.display = 'flex';
        }

        function submitArchive() {
            renderMainGrid();
            closeModal();
        }

        function closeModal() { document.getElementById('cameraModal').style.display = 'none'; }
        
        initMainGrid();
    </script>
</body>
</html>
