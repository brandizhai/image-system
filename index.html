<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>高拍仪影像归档系统</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .guide-bubble {
            background: #fff1f2; border: 1px solid #fda4af; color: #e11d48;
            padding: 4px 10px; border-radius: 4px; font-size: 12px; margin-left: 10px;
        }
        .modal-mask {
            display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.5);
            z-index: 50; align-items: center; justify-content: center;
        }
        /* 拖拽悬停样式 */
        .type-item.drag-over {
            background-color: #dbeafe; border-color: #3b82f6; transform: scale(1.02);
        }
        .photo-thumb {
            cursor: grab; transition: all 0.2s;
        }
        .photo-thumb:active { cursor: grabbing; }
        
        /* 已归档文件的小标签样式 */
        .archived-file {
            font-size: 11px;
            background: #f3f4f6;
            padding: 2px 6px;
            border-radius: 4px;
            margin-top: 4px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border: 1px solid #e5e7eb;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">

    <div class="bg-white p-6 shadow-md flex items-center space-x-12">
        <div class="flex items-center">
            <button onclick="openModal('临柜')" class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded shadow-lg flex items-center">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M3 9a2 2 0 012-2h.93a2 2 0 001.664-.89l.812-1.22A2 2 0 0110.07 4h3.86a2 2 0 011.664.89l.812 1.22A2 2 0 0018.07 7H19a2 2 0 012 2v9a2 2 0 01-2 2H5a2 2 0 01-2-2V9z"></path></svg>
                临柜拍照
            </button>
            <div class="guide-bubble">请点击此处，拍摄临柜业务所需材料</div>
        </div>
          <div class="flex items-center">
            <button onclick="openModal('云柜')" class="bg-emerald-600 hover:bg-emerald-700 text-white px-6 py-2 rounded shadow-lg flex items-center">
                <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path></svg>
                云柜拍照
            </button>
            <div class="guide-bubble">请点击此处，拍摄云柜业务所需材料</div>
        </div>

    <div id="cameraModal" class="modal-mask">
        <div class="bg-white w-11/12 h-5/6 rounded-xl shadow-2xl flex flex-col overflow-hidden">
            <div class="bg-gray-800 p-4 flex justify-between items-center">
                <div class="flex space-x-4">
                    <button class="bg-gray-600 text-white px-4 py-1 rounded hover:bg-gray-500 text-sm">扫描</button>
                    <button onclick="takePhoto()" class="bg-blue-500 text-white px-6 py-1 rounded hover:bg-blue-400 text-sm font-bold">拍摄</button>
                    <button onclick="closeModal()" class="bg-green-600 text-white px-4 py-1 rounded hover:bg-green-500 text-sm">提交</button>
                </div>
                <span id="modalTitle" class="text-white font-medium">影像采集终端</span>
                <button onclick="closeModal()" class="text-gray-400 hover:text-white text-2xl">&times;</button>
            </div>

            <div class="flex-1 flex overflow-hidden">
                <div class="w-72 bg-gray-50 border-r p-4 overflow-y-auto space-y-3">
                    <h4 class="text-xs font-bold text-gray-500 mb-3 uppercase tracking-wider">归档分类</h4>
                    <div id="typeList" class="space-y-2">
                        </div>
                </div>

                <div class="flex-1 bg-black flex items-center justify-center relative">
                    <div class="text-white text-center opacity-50">
                        <svg class="w-16 h-16 mx-auto mb-2" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path></svg>
                        <p>摄像头实时画面</p>
                    </div>
                </div>

                <div class="w-72 bg-gray-100 border-l p-4 overflow-y-auto">
                    <h4 class="text-xs font-bold text-gray-500 mb-3 uppercase tracking-wider">待归档照片 (请拖拽)</h4>
                    <div id="photoPool" class="space-y-4">
                        </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const types = ["投保人身份证", "投保人人脸正面照", "被保人身份证", "其他"];
        let photoCount = 0;

        // 初始化左侧分类
        function initTypes() {
            const list = document.getElementById('typeList');
            types.forEach(name => {
                const div = document.createElement('div');
                // 增加 flex-col 允许内部垂直排列
                div.className = "type-item border-2 border-dashed border-gray-200 bg-white p-3 rounded-lg transition-all flex flex-col";
                div.dataset.name = name;
                
                div.innerHTML = `
                    <div class="flex justify-between items-center mb-1">
                        <span class="text-gray-700 font-bold text-sm">${name}</span>
                        <span class="count-badge bg-blue-500 text-white px-2 py-0.5 rounded-full text-[10px] hidden">0</span>
                    </div>
                    <div class="file-container flex flex-col space-y-1"></div>
                `;

                // 绑定拖拽事件
                div.ondragover = (e) => { e.preventDefault(); div.classList.add('drag-over'); };
                div.ondragleave = () => div.classList.remove('drag-over');
                div.ondrop = (e) => handleDrop(e, name);
                
                list.appendChild(div);
            });
        }

        function openModal(title) {
            document.getElementById('cameraModal').style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('cameraModal').style.display = 'none';
        }

        // 拍摄：生成右侧缩略图
        function takePhoto() {
            photoCount++;
            const pool = document.getElementById('photoPool');
            const id = 'img_' + photoCount;
            const fileName = `IMG_2024_${photoCount.toString().padStart(3, '0')}.jpg`;
            const color = Math.floor(Math.random()*16777215).toString(16);
            
            const card = document.createElement('div');
            card.className = "photo-thumb bg-white p-2 border rounded-lg shadow-sm group";
            card.draggable = true;
            card.id = id;
            card.dataset.filename = fileName; // 存储文件名
            
            // 传递 ID 到拖拽事件
            card.ondragstart = (e) => {
                e.dataTransfer.setData("text/plain", id);
                card.classList.add('opacity-50');
            };
            card.ondragend = () => card.classList.remove('opacity-50');
            
            card.innerHTML = `
                <img src="https://via.placeholder.com/240x160/${color}/ffffff?text=${photoCount}" class="w-full rounded mb-2">
                <div class="text-[11px] text-gray-500 font-mono truncate">${fileName}</div>
            `;
            pool.prepend(card);
        }

        // 核心逻辑：处理释放
        function handleDrop(e, typeName) {
            e.preventDefault();
            const targetTypeBox = e.currentTarget;
            targetTypeBox.classList.remove('drag-over');
            
            const photoId = e.dataTransfer.getData("text/plain");
            const originalPhoto = document.getElementById(photoId);
            
            if (originalPhoto) {
                const fileName = originalPhoto.dataset.filename;
                const fileContainer = targetTypeBox.querySelector('.file-container');
                
                // 1. 创建左侧展示的小标签
                const fileTag = document.createElement('div');
                fileTag.className = "archived-file";
                fileTag.innerHTML = `
                    <span class="truncate w-40 text-gray-600">${fileName}</span>
                    <svg class="w-3 h-3 text-green-500" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path></svg>
                `;
                
                // 2. 将标签添加到对应分类下
                fileContainer.appendChild(fileTag);
                
                // 3. 更新计数徽章
                const badge = targetTypeBox.querySelector('.count-badge');
                const currentCount = fileContainer.children.length;
                badge.innerText = currentCount;
                badge.classList.remove('hidden');
                
                // 4. 样式反馈
                targetTypeBox.classList.replace('border-gray-200', 'border-blue-400');
                
                // 5. 从右侧待处理区移除
                originalPhoto.remove();
            }
        }

        initTypes();
    </script>
</body>
</html>
